/*!CK:368190744!*//*1427545393,*/

if (self.CavalryLogger) { CavalryLogger.start_js(["N02sE"]); }

__d("PagesMessagingConst",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();e.exports={LOAD_MESSAGE_THREAD_URI:"\/ajax\/pages\/messages\/load_message_thread.php",ASYNC_ENDPOINT:"\/ajax\/messaging\/async.php"};},null);
__d("Base64",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();var g='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';function h(l){l=(l.charCodeAt(0)<<16)|(l.charCodeAt(1)<<8)|l.charCodeAt(2);return String.fromCharCode(g.charCodeAt(l>>>18),g.charCodeAt((l>>>12)&63),g.charCodeAt((l>>>6)&63),g.charCodeAt(l&63));}var i='>___?456789:;<=_______'+'\0\1\2\3\4\5\6\7\b\t\n\13\f\r\16\17\20\21\22\23\24\25\26\27\30\31'+'______\32\33\34\35\36\37 !"#$%&\'()*+,-./0123';function j(l){l=(i.charCodeAt(l.charCodeAt(0)-43)<<18)|(i.charCodeAt(l.charCodeAt(1)-43)<<12)|(i.charCodeAt(l.charCodeAt(2)-43)<<6)|i.charCodeAt(l.charCodeAt(3)-43);return String.fromCharCode(l>>>16,(l>>>8)&255,l&255);}var k={encode:function(l){l=unescape(encodeURI(l));var m=(l.length+2)%3;l=(l+'\0\0'.slice(m)).replace(/[\s\S]{3}/g,h);return l.slice(0,l.length+m-2)+'=='.slice(m);},decode:function(l){l=l.replace(/[^A-Za-z0-9+\/]/g,'');var m=(l.length+3)&3;l=(l+'AAA'.slice(m)).replace(/..../g,j);l=l.slice(0,l.length+m-3);try{return decodeURIComponent(escape(l));}catch(n){throw new Error('Not valid UTF-8');}},encodeObject:function(l){return k.encode(JSON.stringify(l));},decodeObject:function(l){return JSON.parse(k.decode(l));},encodeNums:function(l){return String.fromCharCode.apply(String,l.map(function(m){return g.charCodeAt((m|-(m>63))&-(m>0)&63);}));}};e.exports=k;},null);
__d("Deferred",["Promise"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();function h(){"use strict";this.$Deferred0=false;this.$Deferred1=new g(function(i,j){this.$Deferred2=i;this.$Deferred3=j;}.bind(this));}h.prototype.getPromise=function(){"use strict";return this.$Deferred1;};h.prototype.resolve=function(i){"use strict";this.$Deferred0=true;this.$Deferred2(i);};h.prototype.reject=function(i){"use strict";this.$Deferred0=true;this.$Deferred3(i);};h.prototype.then=function(){"use strict";return g.prototype.then.apply(this.$Deferred1,arguments);};h.prototype.done=function(){"use strict";g.prototype.done.apply(this.$Deferred1,arguments);};h.prototype.isSettled=function(){"use strict";return this.$Deferred0;};e.exports=h;},null);
__d("whitelistObjectKeys",[],function(a,b,c,d,e,f){b.__markCompiled&&b.__markCompiled();function g(h,i){var j={},k=Array.isArray(i)?i:Object.keys(i);for(var l=0;l<k.length;l++)if(typeof h[k[l]]!=='undefined')j[k[l]]=h[k[l]];return j;}e.exports=g;},null);
__d("StoreBasedStateMixinHelper",["SubscriptionsHandler","invariant"],function(a,b,c,d,e,f,g,h){b.__markCompiled&&b.__markCompiled();'use strict';function i(j){h(j.length>0);this.$StoreBasedStateMixinHelper0=j;this.$StoreBasedStateMixinHelper1=new g();}i.prototype.subscribeCallback=function(j){var k=this.$StoreBasedStateMixinHelper0.map(function(l){if(l.hasChanged&&l.getDispatchToken&&l.addListener){return l.addListener(j);}else if(l.subscribe){return l.subscribe('change',j);}else if(l.addListener){return l.addListener('change',j);}else h(false);});this.$StoreBasedStateMixinHelper1.addSubscriptions.apply(this.$StoreBasedStateMixinHelper1,k);};i.prototype.release=function(){this.$StoreBasedStateMixinHelper1.release();};e.exports=i;},null);
__d("StoreAndPropBasedStateMixin",["StoreBasedStateMixinHelper","invariant","setImmediate"],function(a,b,c,d,e,f,g,h,i){b.__markCompiled&&b.__markCompiled();'use strict';var j=function(){for(var k=[],l=0,m=arguments.length;l<m;l++)k.push(arguments[l]);return {getInitialState:function(){return this.constructor.calculateState(this.props);},componentWillMount:function(){h(this.constructor.calculateState);this._recalculateStateID=null;var n=function(){if(this.isMounted())this.setState(this.constructor.calculateState(this.props));this._recalculateStateID=null;}.bind(this);this._mixin=new g(k);this._mixin.subscribeCallback(function(){if(this._recalculateStateID===null)this._recalculateStateID=i(n);}.bind(this));},componentWillReceiveProps:function(n){this.setState(this.constructor.calculateState(n));},componentWillUnmount:function(){this._mixin.release();this._mixin=null;}};}.bind(this);e.exports=j;},null);
__d("MercuryUnseenState",["MercuryFolders","KeyedCallbackManager","LogHistory","MercuryActionType","MercurySingletonMixin","MercuryThreadInfo","MercuryThreadlistConstants","MessagingTag","MercuryServerRequests","MercuryThreadInformer","MercuryThreads","copyProperties","createObjectFrom","isEmpty"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t){b.__markCompiled&&b.__markCompiled();var u=m.MAX_UNSEEN_COUNT,v='unseen_thread_hash',w='unseen_thread_list',x=i.getInstance('mercury_unseen_state');function y(na){this._fbid=na;this._serverRequests=o.getForFBID(this._fbid);this._threads=q.getForFBID(this._fbid);this._threadInformer=p.getForFBID(this._fbid);this._initialUnseenCount=null;this._lastSeenTimestamp=0;this._maxCount=false;this._pendingServerUpdates=false;this._unseenResources=new h();this._serverRequests.subscribe('update-unseen',function(oa,pa){ea(this,pa);}.bind(this));this._serverRequests.subscribe('update-thread-ids',function(oa,pa){ka(this,pa);}.bind(this));}r(y.prototype,{getUnseenCount:function(){if(this.exceedsMaxCount()){x.error('unguarded_unseen_count_fetch',{});return 0;}return da(this)||0;},exceedsMaxCount:function(){return this._maxCount||(da(this)>u);},markAsSeen:function(){var na=da(this);if(na===null){this._pendingServerUpdates=true;}else if(na>0||this._maxCount){this._serverRequests.markSeen();var oa=this._serverRequests.getLastActionTimestamp();fa(this,oa,[]);}}});r(y,k);function z(na,oa,pa){var qa={};qa[oa]=0;ha(na,qa,pa);}function aa(na,oa){na._unseenResources.setResource(v,oa);na._unseenResources.setResource(w,Object.keys(oa));}function ba(na,oa){var pa=na._unseenResources.executeOrEnqueue(v,oa),qa=na._unseenResources.getUnavailableResources(pa);if(qa.length)na._serverRequests.fetchUnseenThreadIDs();}function ca(na){return na._unseenResources.getResource(v);}function da(na){var oa=na._unseenResources.getResource(w);if(oa){return oa.length;}else return na._initialUnseenCount;}function ea(na,oa){var pa=ma(oa);if(oa.unseen_thread_fbids){oa.unseen_thread_fbids.forEach(function(ab){if(ab.folder!=n.INBOX)return;var bb=ab.thread_fbids||[];bb=bb.concat(ab.other_user_fbids||[]);var cb=ja(na,bb),db=na._lastSeenTimestamp;if(pa&&pa.seen_timestamp)db=pa.seen_timestamp;fa(na,db,cb);if(pa&&pa.unseen_count>u)na._maxCount=true;});}else if(pa&&pa.seen_timestamp){na._lastSeenTimestamp=pa.seen_timestamp;if(pa.unseen_count>u){na._maxCount=true;aa(na,{});}else{na._initialUnseenCount=pa.unseen_count;if(na._initialUnseenCount===0)aa(na,{});}}else{if(na._maxCount)return;var qa=oa.actions;if(!qa||!(qa.length))return;var ra={},sa={};for(var ta=0;ta<qa.length;ta++){var ua=qa[ta];if(ua.is_forward)continue;var va=ua.action_type,wa=ua.other_user_fbid?ua.other_user_fbid:ua.thread_fbid,xa=ua.thread_id?ua.thread_id:wa;if(va==j.MARK_THREAD_SEEN){z(na,xa,ua.persistent);continue;}if(!la(na,ua))continue;if(va==j.USER_GENERATED_MESSAGE||va==j.LOG_MESSAGE){var ya=ra[xa]?ua.timestamp>ra[xa]:false,za=ya||!ra[xa];if(ua.is_unread&&za)na._threads.getThreadMeta(xa,function(ab){var bb=false;if(ab&&ab.last_read_timestamp)if(ab.last_read_timestamp>=ua.timestamp)bb=true;if(!l.isMuted(ab)&&!bb)ra[xa]=ua.timestamp;});}else if(va==j.CHANGE_READ_STATUS&&ua.mark_as_read)sa[xa]=ua.timestamp;}ga(na,ra);ha(na,sa);}if(na._pendingServerUpdates){na._pendingServerUpdates=false;na.markAsSeen();}}function fa(na,oa,pa){var qa=ca(na);if(qa===(void 0)||oa>na._lastSeenTimestamp||na._maxCount){na._lastSeenTimestamp=oa;pa=pa||[];if(pa.length<=u)na._maxCount=false;var ra={},sa=ca(na)||{};for(var ta in sa)if(sa[ta]!==true){var ua=sa[ta];if(ia(na,ua))ra[ta]=ua;}var va=r(s(pa,true),ra);aa(na,va);na._threadInformer.updatedUnseenState();}}function ga(na,oa){if(na._maxCount)return;var pa={},qa=false;for(var ra in oa){var sa=oa[ra];if(ia(na,sa)){pa[ra]=sa;qa=true;}}if(!qa)return;ba(na,function(ta){for(var ua in pa){var va=pa[ua];if(!ta[ua]&&ia(na,va))ta[ua]=pa[ua];}aa(na,ta);na._threadInformer.updatedUnseenState();});}function ha(na,oa,pa){var qa=false;if(!t(oa))qa=true;if(qa)ba(na,function(ra){var sa=false;for(var ta in oa){var ua=oa[ta],va=ua>ra[ta];if(ra[ta]&&(!ua||va)){delete ra[ta];sa=true;}}if(sa){aa(na,ra);na._threadInformer.updatedUnseenState();if(pa&&da(na)===0)na._serverRequests.markSeen();}});}function ia(na,oa){return oa>na._lastSeenTimestamp;}function ja(na,oa){return oa.map(na._serverRequests.convertThreadIDIfAvailable,na._serverRequests);}function ka(na,oa){var pa=ca(na);if(!pa)return;for(var qa in oa){var ra=oa[qa];if(pa[qa]){pa[ra]=pa[qa];delete pa[qa];}}aa(na,pa);}function la(na,oa){var pa=oa.thread_id?na._threads.getThreadMetaNow(oa.thread_id):null,qa=pa?g.getFromMeta(pa):oa.folder;return qa===n.INBOX||qa===(void 0);}function ma(na){var oa=(na.message_counts||[]);for(var pa=0;pa<oa.length;pa++)if(oa[pa].folder==n.INBOX)return oa[pa];return null;}e.exports=y;},null);
__d("VaultBoxURI",["URI"],function(a,b,c,d,e,f,g){b.__markCompiled&&b.__markCompiled();var h={PHOTOS_SYNCED:'photos_synced',isVaultBoxURI:function(i){var j=new RegExp("\/"+h.PHOTOS_SYNCED+"\/?$");return i.getPath().match(j)&&i.getQueryData().hasOwnProperty('view_image');},isVaultArchiveURI:function(i){var j=new RegExp("\/"+h.PHOTOS_SYNCED+"\/?$");return i.getPath().match(j);},getSyncedTabURI:function(){return new g('/me/'+h.PHOTOS_SYNCED).getQualifiedURI();}};e.exports=h;},null);